<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cast Debug Receiver - Data Viewer (No Subs Test)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>

    <style>
        body {
            background-color: #1a1a1a;
            color: #f5f5f5;
            font-family: monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: auto;
            padding: 20px;
        }
        h1 {
            color: #1e90ff; /* Accent blue */
            font-size: 24px;
            margin-bottom: 30px;
        }
        .data-viewer {
            background: #2b2b2b;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 800px;
            white-space: pre-wrap; 
            word-wrap: break-word; 
            font-size: 16px;
            line-height: 1.5;
        }
        .label {
            color: #a4a9c5;
            font-weight: bold;
            display: block;
            margin-top: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #3c3c3c;
        }
        .error {
            color: #ff5252;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>üé¨ Cast Data Viewer (DEBUG)</h1>

    <div id="dataViewer" class="data-viewer">
        <span class="label">STATUS:</span> Waiting for Cast LOAD message...
    </div>

    <script>
        const dataViewer = document.getElementById('dataViewer');

        function displayData(key, value, isError = false) {
            const entry = document.createElement('div');
            entry.innerHTML = `<span class="label">${key}:</span> ${value}`;
            if (isError) {
                entry.querySelector('.label').classList.add('error');
            }
            dataViewer.appendChild(entry);
        }

        window.onload = function() {
            if (!window.cast || !window.cast.receiver) {
                displayData("ERROR", "Cast SDK not loaded or environment is incorrect.", true);
                return;
            }

            const context = cast.receiver.CastReceiverContext.getInstance();
            const playerManager = context.getPlayerManager();
            
            dataViewer.innerHTML = '';
            displayData("STATUS", "SDK Initialized. Ready to receive.", false);

            playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD, (loadRequest) => {
                
                // --- ŒöŒëŒòŒëŒ°ŒôŒ£ŒúŒüŒ£ ŒöŒëŒô ŒëŒ°ŒßŒôŒöŒüŒ†ŒüŒôŒóŒ£Œó Œ§ŒóŒ£ ŒüŒòŒüŒùŒóŒ£ ---
                dataViewer.innerHTML = '';
                displayData("STATUS", "LOAD message received!", false);
                displayData("TIMESTAMP", new Date().toLocaleString());
                
                const media = loadRequest.media;
                
                // FIX: ŒßŒµŒπœÅŒπŒ∂œåŒºŒ±œÉœÑŒµ œÑŒ∑ŒΩ œÄŒµœÅŒØœÄœÑœâœÉŒ∑ œÄŒøœÖ œÑŒø media object ŒµŒØŒΩŒ±Œπ Œ∫ŒµŒΩœå/null
                const videoUrl = media ? media.contentId : 'N/A (Media object missing)';
                const tracks = media && media.mediaTracks ? media.mediaTracks : [];
                
                
                // --- 1. ŒïŒºœÜŒ¨ŒΩŒπœÉŒ∑ Video URL ---
                displayData("VIDEO URL (contentId)", videoUrl || 'NULL / EMPTY');

                // --- 2. ŒïŒºœÜŒ¨ŒΩŒπœÉŒ∑ Content Type ---
                displayData("CONTENT TYPE", media ? media.contentType : 'N/A');

                // --- 3. ŒïŒºœÜŒ¨ŒΩŒπœÉŒ∑ Œ•œÄŒøœÑŒØœÑŒªœâŒΩ (Media Tracks) ---
                if (tracks.length > 0) {
                    displayData("SUBTITLE TRACKS FOUND", tracks.length);
                    
                    tracks.forEach((track, index) => {
                        if (track.type === cast.framework.messages.MediaTrack.Type.TEXT) {
                            const subUrl = track.trackContentId || 'URL MISSING (ERROR)';
                            const subLabel = track.name || track.language || 'Label MISSING';
                            
                            displayData(`  - Track ${index + 1} (TEXT)`, `Label: ${subLabel}, URL: ${subUrl}`);
                            
                            if (subUrl.includes('MISSING')) {
                                displayData("WARNING", "Subtitle Content ID is empty. Check Java getMediaInfo.", true);
                            }
                        }
                    });

                } else {
                    displayData("SUBTITLE TRACKS FOUND", "0 (Correct for no subs scenario)");
                }

                // ŒïœÄŒπœÉœÑœÅŒ≠œÜŒøœÖŒºŒµ œÑŒø Œ±ŒØœÑŒ∑ŒºŒ± Œ±œÖœÑŒøœçœÉŒπŒø
                return loadRequest;
            });

            context.start();
        };
    </script>
</body>
</html>
