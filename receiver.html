<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cast Debug Receiver - Data Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>

    <style>
        body {
            background-color: #1a1a1a;
            color: #f5f5f5;
            font-family: monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: auto;
            padding: 20px;
        }
        h1 {
            color: #1e90ff; /* Accent blue */
            font-size: 24px;
            margin-bottom: 30px;
        }
        .data-viewer {
            background: #2b2b2b;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 800px;
            white-space: pre-wrap; /* Î”Î¹Î±Ï„Î·ÏÎµÎ¯ Ï„Î¹Ï‚ Î±Î»Î»Î±Î³Î­Ï‚ Î³ÏÎ±Î¼Î¼Î®Ï‚ */
            word-wrap: break-word; /* Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î¿ ÏƒÏ€Î¬ÏƒÎ¹Î¼Î¿ Î¼ÎµÎ³Î¬Î»Ï‰Î½ URLs */
            font-size: 16px;
            line-height: 1.5;
        }
        .label {
            color: #a4a9c5;
            font-weight: bold;
            display: block;
            margin-top: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #3c3c3c;
        }
        .error {
            color: #ff5252;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>ğŸ¬ Cast Data Viewer (DEBUG)</h1>

    <div id="dataViewer" class="data-viewer">
        <span class="label">STATUS:</span> Waiting for Cast LOAD message...
    </div>

    <script>
        const dataViewer = document.getElementById('dataViewer');

        function displayData(key, value, isError = false) {
            const entry = document.createElement('div');
            entry.innerHTML = `<span class="label">${key}:</span> ${value}`;
            if (isError) {
                entry.querySelector('.label').classList.add('error');
                entry.querySelector('span:last-child').classList.add('error');
            }
            dataViewer.appendChild(entry);
        }

        window.onload = function() {
            if (!window.cast || !window.cast.receiver) {
                displayData("ERROR", "Cast SDK not loaded or environment is incorrect.", true);
                return;
            }

            const context = cast.receiver.CastReceiverContext.getInstance();
            const playerManager = context.getPlayerManager();
            
            // ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î¼Î®Î½Ï…Î¼Î±
            dataViewer.innerHTML = '';
            displayData("STATUS", "SDK Initialized. Ready to receive.", false);

            playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD, (loadRequest) => {
                
                // --- ÎšÎ‘Î˜Î‘Î¡Î™Î£ÎœÎŸÎ£ ÎšÎ‘Î™ Î‘Î¡Î§Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— Î¤Î—Î£ ÎŸÎ˜ÎŸÎÎ—Î£ ---
                dataViewer.innerHTML = '';
                displayData("STATUS", "LOAD message received!", false);
                displayData("TIMESTAMP", new Date().toLocaleString());
                
                const media = loadRequest.media;
                const videoUrl = media ? media.contentId : 'N/A (Media object missing)';
                const tracks = media && media.mediaTracks ? media.mediaTracks : [];
                
                // --- 1. Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Video URL ---
                displayData("VIDEO URL (contentId)", videoUrl || 'NULL / EMPTY');

                // --- 2. Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î¥Ï€Î¿Ï„Î¯Ï„Î»Ï‰Î½ (Media Tracks) ---
                if (tracks.length > 0) {
                    displayData("SUBTITLE TRACKS FOUND", tracks.length);
                    
                    tracks.forEach((track, index) => {
                        if (track.type === cast.framework.messages.MediaTrack.Type.TEXT) {
                            const subUrl = track.trackContentId || 'URL MISSING';
                            const subLabel = track.name || track.language || 'Label MISSING';
                            
                            displayData(`  - Track ${index + 1} (TEXT)`, `Label: ${subLabel}, URL: ${subUrl}`);
                            
                            if (subUrl.includes('MISSING')) {
                                displayData("WARNING", "Subtitle Content ID is empty. Check Java getMediaInfo.", true);
                            }
                        }
                    });

                } else {
                    displayData("SUBTITLE TRACKS FOUND", "0 (No subtitles sent)");
                }
                
                // --- 3. Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Custom Data (Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½) ---
                const customData = loadRequest.customData;
                if (customData) {
                    displayData("CUSTOM DATA (JSON)", JSON.stringify(customData, null, 2));
                } else {
                    displayData("CUSTOM DATA", "None");
                }


                // Î•Ï€ÎµÎ¹Î´Î® ÎµÎ¯Î½Î±Î¹ debug receiver, ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†Î¿Ï…Î¼Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Î±Ï…Ï„Î¿ÏÏƒÎ¹Î¿
                // ÏÏƒÏ„Îµ Ï„Î¿ Cast SDK Î½Î± Î±Î½Î±Î³Î½Ï‰ÏÎ¯ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÏ€Î¹Ï„Ï…Ï‡Î·Î¼Î­Î½Î· Î»Î®ÏˆÎ· Ï„Î¿Ï….
                return loadRequest;
            });

            context.start();
        };
    </script>
</body>
</html>
