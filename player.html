<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GRMF Cast Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8/dist/hls.min.js"></script>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
  font-family: Arial, sans-serif;
}
video { width:100%; height:100%; background:#000; }

.overlay {
  position: absolute; inset: 0;
  background: linear-gradient(to top, rgba(0,0,0,.8), transparent);
  display: flex; flex-direction: column; justify-content: flex-end;
  padding: 25px; opacity: 0;
  transition: .3s ease;
}
.overlay.show { opacity:1; pointer-events:auto; }

.controls { display:flex; gap:10px; align-items:center; }
button {
  background:#111;color:#fff;border:1px solid #444;
  padding:10px 16px;border-radius:12px;font-size:14px;
}
</style>
</head>
<body>

<video id="video" crossorigin="anonymous"></video>
<div id="overlay" class="overlay">
  <div class="controls">
    <button id="back">‚è™ 10s</button>
    <button id="play">‚è∏</button>
    <button id="fwd">10s ‚è©</button>
    <button id="mute">üîä</button>
  </div>
</div>

<script>
const video = document.getElementById('video');
const overlay = document.getElementById('overlay');
const back = document.getElementById('back');
const play = document.getElementById('play');
const fwd = document.getElementById('fwd');
const mute = document.getElementById('mute');

let hls = null;
let hideTimer = null;

function showUI() {
  overlay.classList.add('show');
  clearTimeout(hideTimer);
  hideTimer = setTimeout(() => {
    overlay.classList.remove('show');
  }, 3000);
}

function reset() {
  if (hls) { hls.destroy(); hls = null; }
  video.pause();
  video.removeAttribute('src');
  video.load();
  video.querySelectorAll('track').forEach(t => t.remove());
}

function attachSubs(url) {
  if (!url || !url.endsWith('.vtt')) return;
  const tr = document.createElement('track');
  tr.kind = 'subtitles';
  tr.src = url;
  tr.default = true;
  video.appendChild(tr);
}

function loadStream(url, subUrl) {
  reset();
  if (!url) return;

  if (url.includes('.m3u8') && Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      attachSubs(subUrl);
      video.play().catch(()=>{});
      showUI();
    });
  } else {
    video.src = url;
    attachSubs(subUrl);
    video.play().catch(()=>{});
    showUI();
  }
}

// Button logic
play.onclick = () => { video.paused ? video.play() : video.pause(); };
back.onclick = () => video.currentTime = Math.max(0, video.currentTime - 10);
fwd.onclick = () => video.currentTime += 10;
mute.onclick = () => {
  video.muted = !video.muted;
  mute.textContent = video.muted ? 'üîá' : 'üîä';
};

// üî• Receive casts
window.addEventListener('message', (event) => {
  const d = event.data || {};

  if (d.type === 'LOAD_STREAM') {
    loadStream(d.url, d.subUrl);
  }

  if (d.type === 'REMOTE_KEY') {
    showUI();
    switch (d.key) {
      case 'Enter':
      case 'MediaPlayPause':
      case ' ':
        video.paused ? video.play() : video.pause();
        break;
      case 'ArrowLeft':
        video.currentTime = Math.max(0, video.currentTime - 10);
        break;
      case 'ArrowRight':
        video.currentTime += 10;
        break;
    }
  }
});
</script>

</body>
</html>
