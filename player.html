<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GRMF Player</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8/dist/hls.min.js"></script>

<style>
html,body{
  margin:0;width:100%;height:100%;
  background:#000;font-family:Arial,system-ui;
  overflow:hidden;
}
video{
  width:100%;height:100%;object-fit:contain;background:black;
}

/* Overlay */
.overlay{
  position:absolute;inset:0;
  background:linear-gradient(to top,rgba(0,0,0,.85),transparent);
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  align-items:center;
  opacity:0;pointer-events:none;
  transition:.25s;
}
.overlay.show{opacity:1;pointer-events:auto}

/* Center controls */
.center-controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:60px;
  margin-bottom:40px;
  width:100%;
}
.cc-btn{
  width:96px;height:96px;
  border-radius:50%;
  border:none;
  background:rgba(0,0,0,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 0 2px rgba(255,255,255,.1);
}
.cc-btn.focus{
  box-shadow:0 0 0 4px yellow,0 0 30px rgba(255,255,0,.6);
}
.cc-btn svg{
  width:56px;height:56px;
  fill:white;
}

/* Seek bar */
.seek-wrap{
  width:80%;
  max-width:1100px;
  padding-bottom:30px;
}
.seek-bar{
  width:100%;height:6px;
  background:#333;border-radius:999px;
  position:relative;
}
.seek-fill{
  height:100%;width:0%;
  background:red;border-radius:999px;
}
.seek-thumb{
  position:absolute;top:50%;
  width:16px;height:16px;
  background:red;border-radius:50%;
  transform:translate(-50%,-50%) scale(0);
}
.seek-thumb.show{
  transform:translate(-50%,-50%) scale(1.2);
}
.time-row{
  display:flex;justify-content:space-between;
  color:white;font-size:12px;margin-top:6px;
}

/* Bottom right popups */
.side-controls{
  position:absolute;
  right:40px;bottom:40px;
  display:flex;gap:18px;
}
.side-btn{
  background:#111;
  color:white;
  border-radius:24px;
  padding:10px 20px;
  border:1px solid #444;
  font-size:14px;
}
.side-btn.focus{outline:3px solid yellow}

/* Quality menu */
.menu{
  position:absolute;
  right:40px;bottom:100px;
  background:#111;
  border:1px solid #444;
  border-radius:14px;
  padding:10px;
  display:none;
}
.menu div{
  color:white;
  padding:6px 14px;
  border-radius:8px;
}
.menu .active{
  background:yellow;color:black;
}
</style>
</head>
<body>

<video id="video"></video>

<div id="overlay" class="overlay">

  <div class="center-controls">
    <button id="btnBack" class="cc-btn">
      <svg viewBox="0 0 24 24"><path d="M11 18V6L2.5 12 11 18zM21 18V6L12.5 12 21 18z"/></svg>
    </button>

    <button id="btnPlay" class="cc-btn">
      <svg id="playI" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      <svg id="pauseI" viewBox="0 0 24 24" style="display:none"><path d="M6 4h4v16H6zM14 4h4v16h-4z"/></svg>
    </button>

    <button id="btnFwd" class="cc-btn">
      <svg viewBox="0 0 24 24"><path d="M13 18V6l8.5 6L13 18zM3 18V6l8.5 6L3 18z"/></svg>
    </button>
  </div>

  <div class="seek-wrap">
    <div id="seekBar" class="seek-bar">
      <div id="seekFill" class="seek-fill"></div>
      <div id="seekThumb" class="seek-thumb"></div>
    </div>
    <div class="time-row">
      <div id="cur">0:00</div>
      <div id="dur">0:00</div>
    </div>
  </div>

  <div class="side-controls">
    <div id="btnSubs" class="side-btn">SUBS</div>
    <div id="btnQuality" class="side-btn">QUALITY</div>
  </div>
</div>

<div id="qMenu" class="menu"></div>

<script>
const v = document.getElementById("video");
const o = document.getElementById("overlay");

const btnBack = document.getElementById("btnBack");
const btnPlay = document.getElementById("btnPlay");
const btnFwd  = document.getElementById("btnFwd");

const seekFill = document.getElementById("seekFill");
const seekThumb = document.getElementById("seekThumb");
const cur = document.getElementById("cur");
const dur = document.getElementById("dur");

const sideBtns=[document.getElementById("btnSubs"),document.getElementById("btnQuality")];
const centerBtns=[btnBack,btnPlay,btnFwd];

let focus="center",cIndex=1,sIndex=0;
let seekMode=false,seekPos=0;

function fmt(t){
  const m=Math.floor(t/60);
  const s=Math.floor(t%60).toString().padStart(2,"0");
  return `${m}:${s}`;
}

function showUI(){ o.classList.add("show"); }

function refresh(){
  [...centerBtns,...sideBtns].forEach(b=>b.classList.remove("focus"));
  seekThumb.classList.remove("show");

  if(focus==="center") centerBtns[cIndex].classList.add("focus");
  else if(focus==="side") sideBtns[sIndex].classList.add("focus");
  else if(focus==="seek") seekThumb.classList.add("show");
}

document.addEventListener("keydown",e=>{
  showUI();
  const k=e.key;

  if(k==="ArrowUp"){
    if(focus==="center"){focus="seek";seekMode=true;seekPos=v.currentTime;}
    else if(focus==="side"){focus="center";cIndex=1;}
  }

  if(k==="ArrowDown"){
    if(focus==="seek"){focus="center";seekMode=false;}
    else if(focus==="center"){focus="side";sIndex=0;}
  }

  if(k==="ArrowLeft"){
    if(focus==="center") cIndex=Math.max(0,cIndex-1);
    else if(focus==="side") sIndex=Math.max(0,sIndex-1);
    else if(focus==="seek") seekPos=Math.max(0,seekPos-10);
  }

  if(k==="ArrowRight"){
    if(focus==="center") cIndex=Math.min(2,cIndex+1);
    else if(focus==="side") sIndex=Math.min(1,sIndex+1);
    else if(focus==="seek") seekPos=Math.min(v.duration,seekPos+10);
  }

  if(k==="Enter"){
    if(focus==="center"){
      if(cIndex===0) v.currentTime-=10;
      if(cIndex===1) v.paused?v.play():v.pause();
      if(cIndex===2) v.currentTime+=10;
    }
    if(focus==="side" && sIndex===0){
      const t=v.textTracks[0];
      if(t) t.mode=t.mode==="showing"?"disabled":"showing";
    }
    if(focus==="seek"){
      v.currentTime=seekPos;
    }
  }

  refresh();
});

v.addEventListener("timeupdate",()=>{
  if(!v.duration) return;
  seekFill.style.width=(v.currentTime/v.duration*100)+"%";
  cur.textContent=fmt(v.currentTime);
  dur.textContent=fmt(v.duration);
});

v.addEventListener("play",()=>{
  document.getElementById("playI").style.display="none";
  document.getElementById("pauseI").style.display="block";
});
v.addEventListener("pause",()=>{
  document.getElementById("playI").style.display="block";
  document.getElementById("pauseI").style.display="none";
});

/* Receiver messages */
window.addEventListener("message",e=>{
  const d=e.data||{};
  if(d.type==="LOAD_STREAM"){
    v.src=d.url;
    if(d.subUrl){
      const t=document.createElement("track");
      t.kind="subtitles";
      t.src=d.subUrl;
      t.default=true;
      v.appendChild(t);
    }
    v.play();
    showUI();
  }
});
</script>
</body>
</html>
